YC.Bridge.extend({initBridge:function(e){YC.Utils.isIframe()&&(window.YC.Bridge=window.top.YC.Bridge),e(),YC.Bridge.registHistoryBackListener()},configBridge:function(e){},notSupported:function(){YC.SimpleDialog.show(YC.Lang.tip,YC.Lang.tip_mes_other7,[{text:YC.Lang.button_sure,handler:function(){}}])},getPicture:function(e,i,o){var t,n;"CAMERA"==e.from.toUpperCase()?YC.Bridge.openCamera(e,function(e){i(e[0])},o):(t=this,n=$('<input type="file" />').on("change",function(){console.log(n[0].files);var e=n[0].files;e.name=e.value,i(t.adaptFileUri(e)[0])}).click())},openCamera:function(e,i,o){var t=this,n=$('<input type="file" accept="image/*">').on("change",function(){console.log(n[0].files);var e=n[0].files;i(t.adaptFileUri(e))}).click()},pickFile:function(e,i,o){YC.LocalStorage.setValue("IfOpen","1");var t=this,n=$('<input type="file" />').on("change",function(){console.log(n[0].files);var e=n[0].files;i(t.adaptFileUri(e))}).click()},adaptFileUri:function(e){for(var i=String.prototype.lastIndexOf,o=String.prototype.substr,t=String.prototype.substring,n=0;n<e.length;n++){var a=e[n];a.lastIndexOf=function(){return i.apply(a.name,arguments)},a.substr=function(){return o.apply(a.name,arguments)},a.substring=function(){return t.apply(a.name,arguments)}}return e},initImagePreview:function(e,i,o){var t=(t=e.imgs)||document.getElementsByClassName("need-preview");let n=[];for(let o=0;o<t.length;o++){var a=t[o],r=a.attributes.msrc?a.attributes.msrc.nodeValue:a.src,p=a.attributes.filename.value;a.attributes.type&&a.attributes.type.nodeValue;r&&n.push({id:r,fileExtension:"."+(p?p.split(".").pop():""),fileName:p}),a.onclick=function(e){var i={files:n,index:o,canRotate:!0,canPrint:!0,returnUrl:!0,hiddenBack:!0,canDownload:!0};i.extraParams={apiHost:YC.StaticAppProps.APP_ROOT_URL,authId:""},YYCooperationBridge.YYPreviewFilesV2(i).then(function(e){console.log(e),YC.Bridge.previewDocInIframe(e)})}}},previewImage:function(e,i,o){for(var t=e.image,n=Array.isArray(t)?t:[t],a=(e.current,[]),r=[],p=0;p<n.length;p++){var s=n[p];(0<=s.indexOf("http")?a:(s=YC.Utils.getUrlParam("?"+s,"filePaths"),r)).push(s)}0<r.length?YC.FileService.previewImgByFilePath(r,function(e){for(var i in e)"expiration"!=i&&a.push(e[i]);console.log("预览图片链接",a),window.open(a[0])}):(console.log("预览图片链接",a),window.open(a[0]))},previewImageByWPS:function(e,i,o){for(var t=e.image,n=Array.isArray(t)?t:[t],a=(e.current,[]),r=[],p=0;p<n.length;p++){var s=n[p];(0<=s.indexOf("http")?a:(s=YC.Utils.getUrlParam("?"+s,"filePaths"),r)).push(s)}0<r.length?YC.Utils.invokeBusinessProcedure("/bill/getMobileTallyPreviewUrl.mjson",{vpicturefileid:r[0]},function(e){YC.Bridge.openPopWindow(e.invocationResult.previewurl)},function(e){console.log(e)}):(console.log("预览图片链接",a),YC.Bridge.openPopWindow(a[0]))},openPopWindow:function(e){YC.LocalStorage.setValue("openPopWindow","1"),YC.Bridge.popwindowVm?(YC.Bridge.popwindowVm.$set(YC.Bridge.popwindowVm.$data,"showPopPage",!0),YC.Bridge.popwindowVm.$set(YC.Bridge.popwindowVm.$data,"pageUrl",e)):($("body").append($('<div id="popwindow"></div>')),YC.Bridge.popwindowVm=new Vue({el:document.getElementById("popwindow"),data:{pageUrl:e,parentPageTitle:document.title,showPopPage:!0},methods:{closePopWindow:function(){this.showPopPage=!1}},watch:{showPopPage:function(e){e?YC.LocalStorage.setValue("openPopWindow","1"):YC.LocalStorage.clear("openPopWindow")}},render(e){return this.showPopPage?e("yytm-popup",{attrs:{position:"top"},props:{value:this.showPopPage},on:{input:function(e){}},style:{position:"fixed",zIndex:"210",top:"0",width:"100%",height:"100%",backgroundColor:"#fff"}},[e("div",{class:"preview-warp"},[e("div",{class:"preview-header"},[e("div",{class:"preview-close",on:{click:this.closePopWindow}})]),e("div",{class:"preview-content"},[e("iframe",{attrs:{src:this.pageUrl,width:"100%",height:"96%",frameBorder:"0"}})])])]):e()}}))},showPopPage:function(e){for(var i=YC.Utils.getAllUrlParams(e),o={},t=0;t<i.length;t++)o[i[t][0]]=i[t][1];$("body").append($('<div id="popPage"></div>')),YC.Bridge.popPageVm?(YC.Bridge.popPageVm.$set(YC.Bridge.popPageVm.$data,"showPopPage",!0),YC.Bridge.popPageVm.$set(YC.Bridge.popPageVm.$data,"paramsData",o)):YC.Bridge.popPageVm=new Vue({el:"#popPage",data:{pageUrl:window.location.href,parentPageTitle:document.title,showPopPage:!0,paramsData:o},render(e){return this.showPopPage?e("div",{attrs:{id:"popPage"},class:["wrapper-cost","wrapper-card-tally","wecom-poppage"],style:{position:"fixed",zIndex:"200",left:"0",top:"0",width:"100%",height:"100%",backgroundColor:"#fff"}},[e("yytm-page-tallydatalist",{props:{isPopPage:!0,urlParams:this.paramsData}})]):e()}})},previewDoc:function(i,e,o){var t;function n(e){window.open(e)}0<=i.url.indexOf("http")?n(i.url):(t=YC.Utils.getUrlParam("?"+i.url,"filePaths"),i.type&&"field"===i.type?YC.UploadXt.queryPreviewUrl(t,function(e){YC.Bridge.openWindow({url:e,setting:{title:i.fileName}})},function(){},null):YC.Utils.invokeBusinessProcedure("/bill/getMobileTallyPreviewUrl.mjson",{vpicturefileid:t},function(e){n(e.invocationResult.previewurl)},function(e){},null,!1))},previewDocInIframe:function(e,i){var e=YC.Object.isArray(e)?e:[e],o=[],e=(e.forEach(function(e){o.push({url:e,fileType:YC.Utils.getFileType(YC.Utils.getUrlParam(e,"fileName")),fileName:YC.Utils.getUrlParam(e,"fileName")})}),i||0);YC.Bridge.previewPopVM&&YC.Bridge.previewPopVM.mySwiper?(YC.Bridge.previewPopVM.$set(YC.Bridge.previewPopVM.$data,"previewurl",o),YC.Bridge.previewPopVM.$set(YC.Bridge.previewPopVM.$data,"showPrivewPop",!0),YC.Bridge.previewPopVM.$set(YC.Bridge.previewPopVM.$data,"currentIndex",i),YC.Bridge.previewPopVM.mySwiper.slideTo(i)):(YC.Bridge.cacheIframe={},(YC.Utils.isIframe()?window.top:window).$("body").append($('<div id="previewPopPage"></div>')),i=YC.Utils.isIframe()?window.top.document:document,YC.Bridge.previewPopVM=new Vue({el:i.getElementById("previewPopPage"),data:{showPrivewPop:!0,previewurl:o,currentIndex:e,mySwiper:null,showPDF:!1,showPDFUrl:""},mounted:function(){},methods:{onPopupClose:function(){this.showPDF?this.showPDF=!1:this.showPrivewPop=!1},getStyle:function(){if(YC.Utils.isApproveCenterPage())return{position:"fixed",width:"100%",height:"100%",top:"0"}}},template:'    <yytm-popup v-show="showPrivewPop" v-model="showPrivewPop" position="top" :style="getStyle()">               <div class="preview-warp">                   <div class="preview-header" @click.stop="">                       <div class="preview-name"></div>                       <div class="preview-close" @click="onPopupClose"></div>                   </div>                   <div class="preview-content">                       <div ref="pdfContent" style="position: absolute; top: 0; z-index: 11;width: 100%; height: 100%;">\t\t\t\t\t\t \t<iframe :src="previewurl[currentIndex].url" name="myFrame" width="100%" height="100%" scrolling="auto" vspace="0" hspace="0" frameBorder="0"></iframe>\t\t\t\t\t\t </div>                   </div>               </div>           </yytm-popup>'}))},openWindow:function(e,o,i){YC.Object.isFunction(o)&&window.addEventListener("message",function e(i){i=i.data&&JSON.parse(i.data);o(i),YC.LocalStorage.clear(YC.AppProperty.UFT_UPESN_CLOSE_RETURN_DATA),window.removeEventListener("message",e)}),YC.Utils.isFeishu()?setTimeout(function(){window.open(e.url)},300):window.open(e.url)},openWindowForResult:function(e,i,o){YC.Object.isFunction(i)&&(YC.Window.windowCloseCallBack=i),window.yytmPageTallyDataList?YC.Bridge.showPopPage(e.url):$.getScript("/ycmobileupdate/resources/default/apps/com.business.mobile.bx/component/yytm-page-tallydatalist.js",function(){$.getScript("/ycmobileupdate/resources/default/apps/com.business.mobile.bx/component/batch-modify-tallydata.js",function(){YC.Bridge.showPopPage(e.url)})})},closeWindow:function(e,i,o){var t=YC.LocalStorage.getValue(YC.AppProperty.UFT_UPESN_CLOSE_RETURN_DATA);if(t&&YC.Window.windowCloseCallBack){YC.Window.windowCloseCallBack(JSON.parse(t)),YC.Window.windowCloseCallBack=null,YC.Bridge.popPageVm&&(YC.Bridge.popPageVm.$set(YC.Bridge.popPageVm.$data,"showPopPage",!1),document.title=YC.Bridge.popPageVm.parentPageTitle||document.title,YC.Bridge.popPageVm.$set(YC.Bridge.popPageVm.$data,"parentPageTitle",""));try{var n=window.opener,a=window.top;n&&n.postMessage(t,location.origin),a&&a.postMessage(t,location.origin)}catch(e){}}else"1"==YC.LocalStorage.getValue("openPopWindow")?YC.Bridge.popwindowVm&&(YC.Bridge.popwindowVm.showPopPage=!1):window.close()},goBack:function(e,i,o){window.close()},qrCodeScan:function(e,i,o){},showHeader:function(e){e(!1)},showToast:function(e,i,o){},registHistoryBackListener:function(){try{window.history&&window.history.pushState&&(YC.Bridge.completedHistoryListen=!0,$(window).on("popstate",function(){var e;YC.Bridge._historyBackListener.length<=0?YC.Bridge.closeWindow():(e=YC.Bridge._historyBackListener.pop(),YC.Object.isFunction(e)&&e())}))}catch(e){}},addHistoryBackListen:function(e){this._historyBackListener.push(e),window.history.pushState("forward",null,""),console.log("添加一层historyState")},_historyBackListener:[],setNavTitle:function(e,i,o){document.title=e.title},setNavLeft:function(e,i,o){YC.Bridge.addHistoryBackListen(function(){e.onSuccess&&e.onSuccess()})},setNavRight:function(e,i,o){},setNavMenu:function(e,i,o){},closeAPP:function(e,i,o){},chooseWeixinInvoice:function(e,i,o){},chooseAlipayInvoice:function(e,i,o){},downloadFileWithUrl:function(e,i,o){},uploadAction:function(e,i,o,t){e.append("file",i.fileURI);var n=YC.Ajax.getCommonRequestHeaders();$.ajax({url:i.host,data:e,type:"post",processData:!1,contentType:!1,headers:n,success:function(e){console.log(JSON.stringify(e)),o&&o(e)},error:function(e){t(e),console.error("文件上传失败：",e)}})},uploadFile:function(i,o,t){var e,n,a=new FormData;for(e in i.params)a.append(e,i.params[e]);try{i.params&&i.params.pubParam&&(n=JSON.parse(decodeURIComponent(i.params.pubParam)).attachmentAss,YC.Utils.compressImage(i.fileURI,n,function(e){o&&o(e)}))}catch(e){YC.Bridge.uploadAction(a,i,o,t)}},compressLocalImage:function(e,i,o){var t=new FileReader;t.onload=function(e){i({base64str:e.target.result})},t.readAsDataURL(e.fileURI)}});